<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>调试：空白页排查</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1"></script>
  <style>
    body { margin:0; padding:0; font-family:sans-serif; overflow-y:auto; }
    #statusLog { background:#f8f8f8; color:#333; padding:10px; border:1px solid #ccc; margin:10px; white-space:pre; }
    .chartBox { margin:10px; border:1px solid #ccc; padding:10px; }
    canvas { width:100%; height:300px; background:#fff; }
  </style>
</head>
<body>
  <h1>调试：空白页排查</h1>
  <div id="statusLog"></div>

  <div class="chartBox">
    <h2>上图：关键词</h2>
    <canvas id="chartKeywords"></canvas>
  </div>

  <div class="chartBox">
    <h2>下图：气温</h2>
    <canvas id="chartTemp"></canvas>
  </div>

<script>
const KW_URL  = "https://docs.google.com/spreadsheets/d/e/.../pub?output=csv";
const AVG_URL = "https://docs.google.com/spreadsheets/d/e/.../pub?output=csv";
const MAX_URL = "https://docs.google.com/spreadsheets/d/e/.../pub?output=csv";

function log(msg){
  console.log(msg);
  document.getElementById("statusLog").textContent += msg+"\n";
}
function parseCSV(url){
  return new Promise((resolve, reject)=>{
    log("开始加载CSV: "+ url);
    Papa.parse(url, {
      download:true,
      complete: (res)=>{
        log("CSV加载成功: "+ url +" 行数="+res.data.length);
        resolve(res.data);
      },
      error: (err)=>{
        log("CSV加载失败: "+url+" err="+err);
        reject(err);
      }
    });
  });
}

// 仅示例, 不写完整  -> 你可加 “宽表->长表” or “mapAvg[fn]= val”
async function loadKeywords(){
  log("[loadKeywords] 开始");
  const raw = await parseCSV(KW_URL);
  log("[loadKeywords] rawData行数="+raw.length);
  // ... parse & createChartKeywords
  log("[loadKeywords] done, 画出关键词图");
}
async function loadTemperature(){
  log("[loadTemperature] 开始");
  const rawAvg= await parseCSV(AVG_URL);
  log("[loadTemperature] rawAvg行数="+rawAvg.length);
  const rawMax= await parseCSV(MAX_URL);
  log("[loadTemperature] rawMax行数="+rawMax.length);
  // ... parse & createChartTemp
  log("[loadTemperature] done, 画出气温图");
}

window.onload= async()=>{
  log("=== onload ===");
  try{
    await loadKeywords();
    await loadTemperature();
    log("=== 所有加载完成 ===");
  } catch(e){
    log("出现错误: "+ e);
    console.error(e);
  }
};
</script>

</body>
</html>
